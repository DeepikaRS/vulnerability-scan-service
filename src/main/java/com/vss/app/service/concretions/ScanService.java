package com.vss.app.service.concretions;

import com.vss.app.commands.*;
import com.vss.app.model.UploadContext;
import org.springframework.stereotype.Service;

import com.vss.app.service.abstractions.IScanService;
import org.springframework.web.multipart.MultipartFile;

import java.io.IOException;

@Service
public class ScanService implements IScanService {

    private final UploadContext uploadContext;
    private final UploadFilesStep uploadFilesStep;
    private final ConcludeUploadsStep concludeUploadsStep;
    private final CheckScanStatusStep checkScanStatusStep;
    private final TriggerActionsStep triggerActionsStep;

    public ScanService(UploadContext uploadContext, UploadFilesStep uploadFilesStep, ConcludeUploadsStep concludeUploadsStep, CheckScanStatusStep checkScanStatusStep, TriggerActionsStep triggerActionsStep) {
        this.uploadContext = uploadContext;
        this.uploadFilesStep = uploadFilesStep;
        this.concludeUploadsStep = concludeUploadsStep;
        this.checkScanStatusStep = checkScanStatusStep;
        this.triggerActionsStep = triggerActionsStep;
    }

    @Override
    public void orchestrateFileScan(MultipartFile[] files) throws IOException {
        uploadContext.setFiles(files);
        uploadFilesStep
                .linkWith(concludeUploadsStep)
                .linkWith(checkScanStatusStep)
                .linkWith(triggerActionsStep);
        uploadFilesStep.execute(uploadContext);
    }

}

